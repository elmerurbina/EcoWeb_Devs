<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publicaciones</title>
    <!-- Archivo CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/publicaciones.css') }}">
    <!--Visualizar el logo en la parte superior izquierda del titulo -->
    <link rel="icon" href="/static/imagenes/logo.png" type="image/png">
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <h1>Publicaciones</h1>
        <nav>
            <!-- Menu horizontal -->
            <ul>
                <li><a href="{{ url_for('pp') }}">Patrocinar Publicación</a></li> <!-- Esta plantilla falta desarrollarla -->
                <li><a href="{{ url_for('submit_publication') }}">Enviar Publicación</a></li>  <!-- Plantilla para crear nueva publicación -->
                <li><a href="#subscription">Noticias</a></li>  <!-- Lleva a la suscripción del correo -->
            </ul>
        </nav>
    </header>

    <main>
        <section id="docs">
            <p>Para obtener más información o guías de navegación para el sistema, ver la <b><a href="#">Documentación </a></b></p>
        </section>

        <!-- Mostrar las publicaciones desde la base de datos -->
        <section>
            <h2>Publicaciones recientes</h2>
            <ul>
                {% for publication in publications %}
                <div class="publication">
                    <h2>{{ publication.title }}</h2>
                    <p>Categoría: {{ publication.category }}</p>
                    <p>{{ publication.content }}</p>
                    {% if publication.image_filename %}
                        <img src="{{ url_for('static', filename='uploads/' ~ publication.image_filename) }}" alt="Image for {{ publication.title }}" width="200">
                    {% endif %}
                    <p>Creado el: {{ publication.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>

                    <!-- Like and Dislike Buttons -->
                    <div class="likes-dislikes">
                        <button class="like-btn" data-id="{{ publication.id }}" onclick="handleLike('{{ publication.id }}')">
                            <i class="fas fa-thumbs-up"></i> Like
                        </button>
                        <button class="dislike-btn" data-id="{{ publication.id }}" onclick="handleDislike('{{ publication.id }}')">
                            <i class="fas fa-thumbs-down"></i> Dislike
                        </button>
                    </div>
                    <hr>
                </div>
                {% else %}
                    <p>No hay publicaciones disponibles.</p>
                {% endfor %}
            </ul>
        </section>


        <!-- Suscripción por correo -->
        <div class="subscription-form" id="subscription">
            <h2>Recibe noticias sobre fenómenos naturales y todo lo relacionado al cambio climático, de fuentes seguras directo a tu correo electrónico</h2>
            <form id="subscribeForm" action="https://formspree.io/f/https://formspree.io/f/xovaajnb" method="POST">
                <input type="email" id="email" name="email" placeholder="Ingresa tu correo electrónico" required>
                <button type="submit">Suscribirse</button>
                <p id="message" class="message"></p>
            </form>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 EcoWeb Devs. Todos los derechos reservados.</p>
    </footer>

    <!-- Archivo JavaScript de la suscripción por correo -->
    <script src="{{ url_for('static', filename='js/suscripcionEmail.js') }}"></script>

    <!-- JavaScript para los botones de Like y Dislike -->
    <script>
function handleLike(publicationId) {
    const likeBtn = document.querySelector(`button.like-btn[data-id="${publicationId}"]`);
    const dislikeBtn = document.querySelector(`button.dislike-btn[data-id="${publicationId}"]`);

    // Toggle la clase activa para el boton de like
    likeBtn.classList.toggle('active');

    // Si la clase like esta activa, elimina el estado de la clase dislike y guardar el estado del boton
    if (likeBtn.classList.contains('active')) {
        dislikeBtn.classList.remove('active');
        saveLikeState(publicationId, 'like');
    } else {
        saveLikeState(publicationId, 'none');
    }
}

// Misma logica para la funcion del boton de dislike
function handleDislike(publicationId) {
    const likeBtn = document.querySelector(`button.like-btn[data-id="${publicationId}"]`);
    const dislikeBtn = document.querySelector(`button.dislike-btn[data-id="${publicationId}"]`);


    dislikeBtn.classList.toggle('active');


    if (dislikeBtn.classList.contains('active')) {
        likeBtn.classList.remove('active');
        saveLikeState(publicationId, 'dislike');
    } else {
        saveLikeState(publicationId, 'none');
    }
}

// Guardar el estado del boton en almacenamiento local
function saveLikeState(publicationId, state) {
    localStorage.setItem(`publication-${publicationId}`, state);
}

// Cargar el estado del boton desde el almacenamiento local
function loadLikeState(publicationId) {
    const state = localStorage.getItem(`publication-${publicationId}`);
    if (state === 'like') {
        document.querySelector(`button.like-btn[data-id="${publicationId}"]`).classList.add('active');
    } else if (state === 'dislike') {
        document.querySelector(`button.dislike-btn[data-id="${publicationId}"]`).classList.add('active');
    }
}

// Llamar la funcion cada que se carga la pagina para asegurar la persisetncia del estado de los botones
function loadAllStates() {
    const publications = document.querySelectorAll('.like-btn');
    publications.forEach(pub => {
        const publicationId = pub.getAttribute('data-id');
        loadLikeState(publicationId);
    });
}


document.addEventListener('DOMContentLoaded', function() {
    loadAllStates();
});

    </script>
</body>
</html>
