<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publicaciones</title>
    <!-- Archivo CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/publicaciones.css') }}">
    <!--Visualizar el logo en la parte superior izquierda del titulo -->
    <link rel="icon" href="/static/imagenes/logo.png" type="image/png">
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <h1>Publicaciones</h1>
        <nav>
            <!-- Menu horizontal -->
            <ul>
                <li><a href="{{ url_for('pp') }}">Patrocinar Publicación</a></li> <!-- Esta plantilla falta desarrollarla -->
                <li><a href="{{ url_for('submit_publication') }}">Enviar Publicación</a></li>  <!-- Plantilla para crear nueva publicación -->
                <li><a href="#subscription">Noticias</a></li>  <!-- Lleva a la suscripción del correo -->
            </ul>
        </nav>
    </header>

    <main>
        <section id="docs">
            <p>Para obtener más información o guías de navegación para el sistema, ver la <b><a href="#">Documentación </a></b></p>
        </section>

        <!-- Mostrar las publicaciones desde la base de datos -->
        <section>
            <h2>Publicaciones recientes</h2>
            <ul>
                {% for publication in publications %}
                <div class="publication">
                    <h2>{{ publication.title }}</h2>
                    <p>Categoría: {{ publication.category }}</p>
                    <p>{{ publication.content }}</p>
                    {% if publication.image_filename %}
                        <img src="{{ url_for('static', filename='uploads/' ~ publication.image_filename) }}" alt="Image for {{ publication.title }}" width="200">
                    {% endif %}
                    <p>Creado el: {{ publication.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>

                    <!-- Like and Dislike Buttons -->
                    <div class="likes-dislikes">
                        <button class="like-btn" data-id="{{ publication.id }}" onclick="handleLike('{{ publication.id }}')">
                            <i class="fas fa-thumbs-up"></i> Like
                        </button>
                        <button class="dislike-btn" data-id="{{ publication.id }}" onclick="handleDislike('{{ publication.id }}')">
                            <i class="fas fa-thumbs-down"></i> Dislike
                        </button>
                    </div>
                    <hr>
                </div>
                {% else %}
                    <p>No hay publicaciones disponibles.</p>
                {% endfor %}
            </ul>
        </section>

        <!-- Other sections... -->

        <!-- Suscripción por correo -->
        <div class="subscription-form" id="subscription">
            <h2>Recibe noticias sobre fenómenos naturales y todo lo relacionado al cambio climático, de fuentes seguras directo a tu correo electrónico</h2>
            <form id="subscribeForm" action="https://formspree.io/f/https://formspree.io/f/xovaajnb" method="POST">
                <input type="email" id="email" name="email" placeholder="Ingresa tu correo electrónico" required>
                <button type="submit">Suscribirse</button>
                <p id="message" class="message"></p>
            </form>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 EcoWeb Devs. Todos los derechos reservados.</p>
    </footer>

    <!-- Archivo JavaScript de la suscripción por correo -->
    <script src="{{ url_for('static', filename='js/suscripcionEmail.js') }}"></script>
    <!-- JavaScript for Like and Dislike buttons -->
    <script>
        function handleLike(publicationId) {
            fetch(`/like/${publicationId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Gracias por tu like!');
                    } else {
                        alert('Hubo un error al procesar tu like.');
                    }
                });
        }

        function handleDislike(publicationId) {
            fetch(`/dislike/${publicationId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Gracias por tu feedback!');
                    } else {
                        alert('Hubo un error al procesar tu dislike.');
                    }
                });
        }
    </script>
</body>
</html>
